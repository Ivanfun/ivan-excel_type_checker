<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel 資料類型檢查工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9f0;
        }

        .drop-zone {
            border: 2px dashed #4ade80;
            transition: all 0.3s ease;
        }

        .drop-zone:hover, .drop-zone.active {
            border-color: #16a34a;
            background-color: rgba(74, 222, 128, 0.1);
        }

        .upload-icon {
            transition: transform 0.3s ease;
        }

        .drop-zone:hover .upload-icon, .drop-zone.active .upload-icon {
            transform: scale(1.1);
        }

        .btn-primary {
            background-color: #16a34a;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #15803d;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .success-checkmark {
            animation: scale-up 0.5s ease-in-out;
        }

        @keyframes scale-up {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .file-name {
            animation: slide-in 0.5s ease-in-out;
        }

        @keyframes slide-in {
            0% { transform: translateY(-20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .progress-bar {
            height: 4px;
            background-color: #4ade80;
            width: 0%;
            transition: width 0.3s ease;
        }

        .alert {
            animation: fade-in 0.5s ease-in-out;
        }

        @keyframes fade-in {
            0% { opacity: 0; transform: translateY(-10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .excel-icon {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .card {
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            transition: all 0.3s ease;
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.1);
        }

        .file-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 4px;
            margin-bottom: 4px;
        }

        /* 新增樣式以確保左右區塊高度一致 */
        .equal-height-container {
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            .main-card {
                height: 100%;
                display: flex;
                flex-direction: column;
            }

            .main-content {
                flex-grow: 1;
            }
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex flex-col">
        <header class="bg-gradient-to-r from-green-600 to-green-500 text-white shadow-lg">
            <div class="container mx-auto py-6 px-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="excel-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 2l5 5h-5V4zM7 15h2v2H7v-2zm0-4h2v2H7v-2zm6 4h4v2h-4v-2zm0-4h4v2h-4v-2z"></path>
                            </svg>
                        </div>
                        <h1 class="text-2xl md:text-3xl font-bold">Excel 資料類型檢查工具</h1>
                    </div>
                    <div class="hidden md:block">
                        <div class="bg-white bg-opacity-20 rounded-lg px-4 py-2">
                            <span class="text-sm">快速檢測 Excel 中的資料類型不一致問題</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-grow container mx-auto px-4 py-8">
            <div class="grid md:grid-cols-3 gap-8">
                <div class="md:col-span-2">
                    <div class="card bg-white rounded-xl shadow-md overflow-hidden main-card">
                        <div class="p-6 main-content">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                </svg>
                                上傳您的 Excel 檔案
                            </h2>

                            <form id="upload-form" class="space-y-6" action="/upload/" method="POST" enctype="multipart/form-data">
                                <div id="drop-zone" class="drop-zone rounded-lg p-8 flex flex-col items-center justify-center cursor-pointer">
                                    <div class="upload-icon bg-green-100 p-4 rounded-full mb-4">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                        </svg>
                                    </div>
                                    <p class="text-gray-600 text-center mb-2">拖放 Excel 檔案至此處，或點擊選擇檔案</p>
                                    <p class="text-gray-500 text-sm text-center">支援 .xlsx, .xls, .xlsm 格式</p>

                                    <input type="file" id="file-input" name="file" accept=".xlsx,.xls,.xlsm" class="hidden" />
                                </div>

                                <div id="file-info" class="hidden bg-green-50 rounded-lg p-4 border border-green-200">
                                    <div class="flex items-center">
                                        <div class="success-checkmark bg-green-500 rounded-full p-1 mr-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="flex-grow">
                                            <p class="file-name text-sm font-medium text-gray-700">已選擇檔案：<span id="file-name"></span></p>
                                            <div class="mt-1 bg-gray-200 rounded-full overflow-hidden">
                                                <div id="progress-bar" class="progress-bar"></div>
                                            </div>
                                        </div>
                                        <button type="button" id="remove-file" class="ml-2 text-gray-500 hover:text-gray-700">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div class="flex justify-center space-x-4"> <button type="submit" id="submit-btn" class="btn-primary text-white font-medium py-2 px-6 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center" disabled>
                                        開始檢查
                                    </button>
                                    <button type="button" id="reset-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hidden">
                                        重新上傳
                                    </button>
                                </div>
                            </form>

                            <div id="error-message" class="alert mt-6 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded hidden">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-red-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p id="error-text" class="text-sm">上傳的 Excel 檔案缺少必要欄位：Name 或 Data Type</p>
                                    </div>
                                </div>
                            </div>

                            <div id="success-message" class="alert mt-6 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded hidden">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <div class="ml-3 flex-grow">
                                        <p class="text-sm font-medium">檔案處理完成！您可以下載結果檔案。</p>
                                    </div>
                                    <a href="#" id="download-btn" class="btn-primary text-white text-sm font-medium py-2 px-4 rounded-lg flex items-center hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                        </svg>
                                        下載結果
                                    </a>
                                </div>
                            </div>

                            <div id="processing-indicator" class="hidden mt-6 flex flex-col items-center justify-center">
                                <div class="w-16 h-16 border-4 border-green-200 border-t-green-600 rounded-full animate-spin mb-4"></div>
                                <p class="text-gray-600 font-medium">處理中，請稍候...</p>
                            </div>

                            <div class="mt-8 bg-gray-50 rounded-lg p-5 border border-gray-200">
                                <h3 class="text-lg font-medium text-gray-800 mb-4 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                    結果說明
                                </h3>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-100">
                                        <div class="flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mr-3 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                                            </svg>
                                            <span class="text-sm text-gray-700">黃色標記：資料類型不一致</span>
                                        </div>
                                    </div>

                                    <div class="bg-green-50 rounded-lg p-4 border border-green-100">
                                        <div class="flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600 mr-3 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                            </svg>
                                            <span class="text-sm text-gray-700">統計結果：顯示在新工作表</span>
                                        </div>
                                    </div>

                                    <div class="bg-blue-50 rounded-lg p-4 border border-blue-100">
                                        <div class="flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600 mr-3 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                                            </svg>
                                            <span class="text-sm text-gray-700">超連結：點擊可跳轉至問題資料</span>
                                        </div>
                                    </div>
                                </div>
                                </div>

                            <div class="mt-8 border-t border-gray-100 pt-6">
                                <h3 class="text-lg font-medium text-gray-800 mb-4">主要功能</h3>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="feature-card bg-green-50 rounded-lg p-4 flex flex-col items-center text-center">
                                        <div class="feature-icon bg-green-100 p-3 rounded-full mb-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <h4 class="font-medium text-gray-800 mb-2">自動檢測</h4>
                                        <p class="text-sm text-gray-600">自動識別並標記不一致的資料類型</p>
                                    </div>

                                    <div class="feature-card bg-green-50 rounded-lg p-4 flex flex-col items-center text-center">
                                        <div class="feature-icon bg-green-100 p-3 rounded-full mb-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <h4 class="font-medium text-gray-800 mb-2">統計摘要</h4>
                                        <p class="text-sm text-gray-600">生成詳細的統計結果工作表</p>
                                    </div>

                                    <div class="feature-card bg-green-50 rounded-lg p-4 flex flex-col items-center text-center">
                                        <div class="feature-icon bg-green-100 p-3 rounded-full mb-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <h4 class="font-medium text-gray-800 mb-2">超連結導航</h4>
                                        <p class="text-sm text-gray-600">快速定位到問題資料位置</p>
                                    </div>
                                </div>

                                <div class="mt-6 bg-blue-50 rounded-lg p-4 border border-blue-100">
                                    <div class="flex items-start">
                                        <div class="flex-shrink-0 mt-0.5">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="ml-3">
                                            <h4 class="text-sm font-medium text-blue-800">支援的資料類型</h4>
                                            <div class="mt-2 flex flex-wrap">
                                                <span class="file-type bg-blue-100 text-blue-800">String</span>
                                                <span class="file-type bg-green-100 text-green-800">Number</span>
                                                <span class="file-type bg-yellow-100 text-yellow-800">Boolean</span>
                                                <span class="file-type bg-purple-100 text-purple-800">Date</span>
                                                <span class="file-type bg-red-100 text-red-800">Object</span>
                                                <span class="file-type bg-indigo-100 text-indigo-800">Array</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="md:col-span-1 equal-height-container">
                    <div class="card bg-white rounded-xl shadow-md overflow-hidden mb-6">
                        <div class="bg-green-600 py-4 px-6">
                            <h3 class="text-white font-semibold">使用說明</h3>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="flex items-start">
                                <div class="bg-green-100 rounded-full p-1 mr-3 mt-0.5">
                                    <span class="flex h-5 w-5 items-center justify-center rounded-full bg-green-500 text-white text-xs">1</span>
                                </div>
                                <p class="text-gray-600 text-sm">上傳包含 Name 和 Data Type 欄位的 Excel 檔案</p>
                            </div>

                            <div class="flex items-start">
                                <div class="bg-green-100 rounded-full p-1 mr-3 mt-0.5">
                                    <span class="flex h-5 w-5 items-center justify-center rounded-full bg-green-500 text-white text-xs">2</span>
                                </div>
                                <p class="text-gray-600 text-sm">系統會自動檢查每個 Name 對應的 Data Type 是否一致</p>
                            </div>

                            <div class="flex items-start">
                                <div class="bg-green-100 rounded-full p-1 mr-3 mt-0.5">
                                    <span class="flex h-5 w-5 items-center justify-center rounded-full bg-green-500 text-white text-xs">3</span>
                                </div>
                                <p class="text-gray-600 text-sm">不一致的資料會以黃色標記，並在「統計結果」工作表中顯示摘要</p>
                            </div>

                            <div class="mt-6 pt-4 border-t border-gray-100">
                                <div class="bg-yellow-50 rounded-lg p-3 border border-yellow-200">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-xs text-yellow-700">檔案必須包含 Name 和 Data Type 欄位，否則將無法處理</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-white rounded-xl shadow-md overflow-hidden flex-grow">
                        <div class="bg-green-600 py-4 px-6">
                            <h3 class="text-white font-semibold">檔案格式要求</h3>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                    <h4 class="text-sm font-medium text-gray-800 mb-2">必要欄位</h4>
                                    <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                                        <li>Name（名稱）</li>
                                        <li>Data Type（資料類型）</li>
                                    </ul>
                                </div>

                                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                    <h4 class="text-sm font-medium text-gray-800 mb-2">支援的檔案格式</h4>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="file-type bg-green-100 text-green-800">.xlsx</span>
                                        <span class="file-type bg-green-100 text-green-800">.xls</span>
                                        <span class="file-type bg-green-100 text-green-800">.xlsm</span>
                                    </div>
                                </div>

                                <div class="bg-blue-50 rounded-lg p-4 border border-blue-100">
                                    <h4 class="text-sm font-medium text-blue-800 mb-2">範例格式</h4>
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full text-xs">
                                            <thead>
                                                <tr class="bg-blue-100">
                                                    <th class="py-2 px-3 text-left">Name</th>
                                                    <th class="py-2 px-3 text-left">Data Type</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="border-b border-blue-50">
                                                    <td class="py-1.5 px-3">user_id</td>
                                                    <td class="py-1.5 px-3">Number</td>
                                                </tr>
                                                <tr class="border-b border-blue-50">
                                                    <td class="py-1.5 px-3">username</td>
                                                    <td class="py-1.5 px-3">String</td>
                                                </tr>
                                                <tr>
                                                    <td class="py-1.5 px-3">is_active</td>
                                                    <td class="py-1.5 px-3">Boolean</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-100">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mr-3 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                        </svg>
                                        <span class="text-sm text-yellow-700">檔案大小不應超過 10MB</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="bg-green-800 text-white py-6 mt-8">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <p class="text-sm text-green-200" id="copyright-year">© <span id="current-year"></span> Excel 資料類型檢查工具</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            const fileInfo = document.getElementById('file-info');
            const fileName = document.getElementById('file-name');
            const removeFile = document.getElementById('remove-file');
            const submitBtn = document.getElementById('submit-btn');
            const resetBtn = document.getElementById('reset-btn'); // 新增：重設按鈕
            const progressBar = document.getElementById('progress-bar');
            const form = document.getElementById('upload-form');
            const errorMessageDiv = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            const successMessageDiv = document.getElementById('success-message');
            const downloadBtn = document.getElementById('download-btn');
            const processingIndicator = document.getElementById('processing-indicator');

            // 設置頁腳的年份為當前年份
            const currentYear = new Date().getFullYear();
            document.getElementById('current-year').textContent = currentYear;

            // 確保左右區塊高度一致
            function adjustHeight() {
                if (window.innerWidth >= 768) {
                    const leftCard = document.querySelector('.main-card');
                    const rightContainer = document.querySelector('.equal-height-container');

                    // 重置高度以便重新計算
                    leftCard.style.height = 'auto';

                    // 設置延遲以確保DOM已完全渲染
                    setTimeout(() => {
                        const leftHeight = leftCard.offsetHeight;
                        const rightHeight = rightContainer.offsetHeight;

                        if (leftHeight < rightHeight) {
                            leftCard.style.height = rightHeight + 'px';
                        } else if (rightHeight < leftHeight) {
                            // 右側容器會自動調整，不需要設置高度
                        }
                    }, 100);
                }
            }

            // 頁面加載和調整大小時調整高度
            window.addEventListener('load', adjustHeight);
            window.addEventListener('resize', adjustHeight);

            // Click on drop zone to select file
            dropZone.addEventListener('click', function() {
                fileInput.click();
            });

            // Handle file selection
            fileInput.addEventListener('change', function() {
                handleFiles(this.files);
            });

            // Handle drag and drop
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropZone.classList.add('active');
            });

            dropZone.addEventListener('dragleave', function() {
                dropZone.classList.remove('active');
            });

            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                dropZone.classList.remove('active');
                handleFiles(e.dataTransfer.files);
            });

            // Remove selected file (for the X button)
            removeFile.addEventListener('click', function() {
                resetFormState(); // 調用重設函數
            });

            // 新增：重設按鈕點擊處理
            resetBtn.addEventListener('click', function() {
                resetFormState();
            });

            // 重設表單狀態的函數
            function resetFormState() {
                fileInput.value = ''; // 清空檔案選擇
                fileInfo.classList.add('hidden');
                dropZone.classList.remove('hidden');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '開始檢查'; // 恢復按鈕文字
                resetBtn.classList.add('hidden'); // 隱藏重設按鈕
                progressBar.style.width = '0%';
                errorMessageDiv.classList.add('hidden');
                successMessageDiv.classList.add('hidden');
                processingIndicator.classList.add('hidden');
                downloadBtn.removeAttribute('href'); // 清除下載連結
                downloadBtn.classList.add('hidden'); // 隱藏下載按鈕
                adjustHeight(); // 重新調整高度
            }


            // Handle form submission with Fetch API
            form.addEventListener('submit', async function(e) {
                e.preventDefault(); // Prevent default form submission

                if (!fileInput.files.length) {
                    return;
                }

                // Hide any previous messages
                errorMessageDiv.classList.add('hidden');
                successMessageDiv.classList.add('hidden');
                downloadBtn.classList.add('hidden'); // 確保在每次提交前隱藏下載按鈕

                // Show processing indicator
                processingIndicator.classList.remove('hidden');
                submitBtn.disabled = true;
                submitBtn.innerHTML = `
                    <div class="flex items-center justify-center">
                        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        處理中...
                    </div>
                `;
                resetBtn.classList.add('hidden'); // 處理時隱藏重設按鈕

                let progress = 0;
                const interval = setInterval(function() {
                    progress += 5;
                    progressBar.style.width = Math.min(progress, 90) + '%';
                    if (progress >= 90) clearInterval(interval);
                }, 100);

                const formData = new FormData();
                formData.append('file', fileInput.files[0]);

                try {
                    const response = await fetch('/upload/', {
                        method: 'POST',
                        body: formData
                    });

                    clearInterval(interval); // Stop progress simulation
                    progressBar.style.width = '100%'; // Ensure full progress

                    // Expect JSON response
                    const result = await response.json();

                    if (result.success) {
                        successMessageDiv.classList.remove('hidden');
                        errorMessageDiv.classList.add('hidden');
                        if (result.download_filename) {
                             downloadBtn.href = `/download/${result.download_filename}`;
                             downloadBtn.classList.remove('hidden'); // Show download button
                        }
                    } else {
                        errorMessageDiv.classList.remove('hidden');
                        successMessageDiv.classList.add('hidden');
                        errorText.textContent = result.message || "發生未知錯誤。";
                    }

                } catch (error) {
                    clearInterval(interval);
                    progressBar.style.width = '0%'; // Reset on severe error
                    errorMessageDiv.classList.remove('hidden');
                    errorText.textContent = `檔案上傳失敗或伺服器錯誤: ${error.message}`;
                    console.error("Fetch error:", error);
                } finally {
                    submitBtn.innerHTML = '開始檢查';
                    submitBtn.disabled = false;
                    processingIndicator.classList.add('hidden');
                    resetBtn.classList.remove('hidden'); // 處理完成後顯示重設按鈕
                    adjustHeight(); // Re-adjust height after content changes
                }
            });

            // Download button click handler
            downloadBtn.addEventListener('click', async function(e) {
                e.preventDefault();

                const originalDownloadText = downloadBtn.innerHTML;
                downloadBtn.innerHTML = `
                    <div class="flex items-center justify-center">
                        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        下載中...
                    </div>
                `;
                downloadBtn.disabled = true; // 禁用下載按鈕防止重複點擊

                // Programmatically trigger download
                const downloadLink = document.createElement('a');
                downloadLink.href = this.href;
                downloadLink.download = this.href.split('/').pop(); // Extract filename from URL
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);

                setTimeout(() => {
                    downloadBtn.innerHTML = originalDownloadText;
                    downloadBtn.disabled = false; // 重新啟用下載按鈕
                    // Show a success toast
                    const toast = document.createElement('div');
                    toast.className = 'fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in';
                    toast.innerHTML = '檔案已成功下載！';
                    document.body.appendChild(toast);

                    setTimeout(() => {
                        toast.style.opacity = '0';
                        toast.style.transition = 'opacity 0.5s ease';
                        setTimeout(() => {
                            document.body.removeChild(toast);
                        }, 500);
                    }, 3000);
                }, 1500);
            });

            function handleFiles(files) {
                if (files.length > 0) {
                    const file = files[0];

                    // Check if file extension looks like Excel
                    const validExtensions = ['.xlsx', '.xls', '.xlsm'];
                    const fileExt = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();

                    if (!validExtensions.includes(fileExt)) {
                        errorMessageDiv.classList.remove('hidden');
                        errorText.textContent = '請上傳 Excel 格式的檔案 (.xlsx, .xls, .xlsm)';
                        fileInput.value = ''; // Clear selected file
                        resetFormState(); // 重設狀態，確保所有訊息框都隱藏
                        return;
                    }

                    fileName.textContent = file.name;
                    fileInfo.classList.remove('hidden');
                    dropZone.classList.add('hidden');
                    submitBtn.disabled = false;
                    resetBtn.classList.add('hidden'); // 選中檔案後暫時隱藏重設按鈕

                    // Reset any previous messages
                    errorMessageDiv.classList.add('hidden');
                    successMessageDiv.classList.add('hidden');
                    processingIndicator.classList.add('hidden');
                    downloadBtn.classList.add('hidden'); // 隱藏下載按鈕

                    // Animate progress bar to show file is ready
                    progressBar.style.width = '100%';

                    // Add file animation effect
                    fileInfo.classList.add('animate-pulse');
                    setTimeout(() => {
                        fileInfo.classList.remove('animate-pulse');
                    }, 1000);

                    // 重新調整高度
                    adjustHeight();
                }
            }

            // Add some visual effects to cards on page load
            document.querySelectorAll('.card').forEach((card, index) => {
                setTimeout(() => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';

                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 150);
            });

            // Add hover effects to feature cards
            document.querySelectorAll('.feature-card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.classList.add('shadow-md');
                    card.style.transform = 'translateY(-5px)';
                    card.style.transition = 'all 0.3s ease';
                });

                card.addEventListener('mouseleave', () => {
                    card.classList.remove('shadow-md');
                    card.style.transform = 'translateY(0)';
                });
            });

            // Initial state reset on page load
            resetFormState(); // 確保初始狀態是乾淨的
        });
    </script>
</body>
</html>